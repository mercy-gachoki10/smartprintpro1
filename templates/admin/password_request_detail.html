{% extends "base.html" %}

{% block title %}Review Password Request — SmartPrint Pro{% endblock %}

{% block content %}
<section class="dashboard-shell">
  <div class="dashboard-card">
    <a href="{{ url_for('admin_password_requests') }}" class="back-link">← Back to requests</a>
    <h2 style="margin:12px 0;">Request #{{ reset_request.id }}</h2>
    <p style="margin:0;color:var(--muted);">Submitted {{ reset_request.created_at.strftime('%b %d, %Y %I:%M %p') }}</p>

    <div class="detail-grid">
      <div>
        <h4>Account</h4>
        <p><strong>Email:</strong> {{ reset_request.email }}</p>
        <p><strong>Role:</strong> {{ reset_request.user_type|capitalize }}</p>
        <p><strong>Status:</strong>
          {% if reset_request.status == "pending" %}
            <span class="status status-pending">Pending</span>
          {% else %}
            <span class="status status-complete">Completed</span>
          {% endif %}
        </p>
      </div>
      <div>
        <h4>Resolution</h4>
        {% if reset_request.resolved_at %}
          <p><strong>Updated at:</strong> {{ reset_request.resolved_at.strftime('%b %d, %Y %I:%M %p') }}</p>
          <p><strong>By:</strong> {{ reset_request.resolver.full_name if reset_request.resolver else "—" }}</p>
          {% if reset_request.admin_note %}
            <p><strong>Note:</strong> {{ reset_request.admin_note }}</p>
          {% endif %}
        {% else %}
          <p>No action taken yet.</p>
        {% endif %}
      </div>
    </div>

    {% if reset_request.status == "pending" %}
      <form method="post" class="reset-form" novalidate>
        {{ form.hidden_tag() }}
        <div class="form-group">
          {{ form.new_password.label }}
          {{ form.new_password(class_="input-text") }}
          {% for error in form.new_password.errors %}
            <div class="form-errors">{{ error }}</div>
          {% endfor %}
        </div>
        <div class="form-group">
          {{ form.confirm_password.label }}
          {{ form.confirm_password(class_="input-text") }}
          {% for error in form.confirm_password.errors %}
            <div class="form-errors">{{ error }}</div>
          {% endfor %}
        </div>
        <div class="form-group">
          {{ form.admin_note.label }}
          {{ form.admin_note(class_="input-text", placeholder="Optional internal note") }}
          {% for error in form.admin_note.errors %}
            <div class="form-errors">{{ error }}</div>
          {% endfor %}
        </div>
        <button type="submit" class="btn-primary">{{ form.submit.label.text }}</button>
      </form>
    {% else %}
      <div class="info-box">
        This request is closed. You can reopen it by asking the user to submit a new request.
      </div>
    {% endif %}
  </div>
</section>

<style>
  .dashboard-shell{max-width:720px;margin:60px auto;padding:0 20px}
  .dashboard-card{background:#fff;padding:28px;border-radius:16px;box-shadow:0 18px 50px rgba(0,0,0,0.06)}
  .back-link{text-decoration:none;color:var(--purple);font-weight:600}
  .detail-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin:20px 0}
  h4{margin:0 0 6px;color:var(--purple)}
  .status{padding:4px 10px;border-radius:999px;font-size:12px;font-weight:600}
  .status-pending{background:#fef9c3;color:#a16207}
  .status-complete{background:#dcfce7;color:#166534}
  .reset-form{margin-top:24px}
  .form-group{margin-bottom:18px}
  .form-group label{display:block;font-weight:600;margin-bottom:6px;color:var(--purple);font-size:14px}
  .form-group input{width:100%;padding:12px;border:1px solid #e8e6f2;border-radius:10px;font-size:15px}
  .form-group input:focus{outline:none;border-color:var(--purple);box-shadow:0 0 0 3px rgba(107,33,168,0.15)}
  .form-errors{color:#b91c1c;font-size:13px;margin-top:6px}
  .btn-primary{padding:14px;background:var(--purple);color:#fff;border:none;border-radius:10px;font-weight:700;font-size:15px;cursor:pointer;width:100%}
  .btn-primary:hover{background:#571590}
  .info-box{margin-top:24px;padding:14px;border-radius:12px;background:#f4f4f4;color:#555}
</style>
{% endblock %}

