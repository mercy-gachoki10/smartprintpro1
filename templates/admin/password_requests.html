{% extends "base.html" %}

{% block title %}Password Reset Requests — SmartPrint Pro{% endblock %}

{% block content %}
<section class="dashboard-shell">
  <div class="dashboard-card">
    <div class="header-row">
      <div>
        <h2>Password reset requests</h2>
        <p style="margin:4px 0 0;color:var(--muted);font-size:14px;">
          Review pending requests from staff and customers and update their credentials.
        </p>
      </div>
      <a href="{{ url_for('admin_users') }}" class="btn-tertiary">← Back to user management</a>
    </div>

    <div class="tables-grid">
      <div class="table-card">
        <div class="table-header">
          <h3>Pending</h3>
          <span class="pill">{{ pending_requests|length }} open</span>
        </div>
        <table>
          <thead>
            <tr>
              <th>Requested by</th>
              <th>Role</th>
              <th>Requested</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for req in pending_requests %}
              <tr>
                <td>
                  <strong>{{ req.email }}</strong>
                  <div class="muted">{{ req.created_at.strftime('%d %b %Y, %I:%M %p') }}</div>
                </td>
                <td>{{ req.user_type|capitalize }}</td>
                <td>{{ req.created_at.strftime('%b %d, %Y %H:%M') }}</td>
                <td class="text-right">
                  <a href="{{ url_for('admin_password_request_detail', request_id=req.id) }}" class="link-btn">Review</a>
                </td>
              </tr>
            {% else %}
              <tr><td colspan="4" class="empty-cell">No pending requests.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="table-card">
        <div class="table-header">
          <h3>Recently closed</h3>
        </div>
        <table>
          <thead>
            <tr>
              <th>User</th>
              <th>Role</th>
              <th>Closed by</th>
              <th>Resolved</th>
            </tr>
          </thead>
          <tbody>
            {% for req in recent_requests %}
              <tr>
                <td>{{ req.email }}</td>
                <td>{{ req.user_type|capitalize }}</td>
                <td>{{ req.resolver.full_name if req.resolver else "—" }}</td>
                <td>
                  {% if req.resolved_at %}
                    {{ req.resolved_at.strftime('%b %d, %Y %H:%M') }}
                  {% else %}
                    —
                  {% endif %}
                </td>
              </tr>
            {% else %}
              <tr><td colspan="4" class="empty-cell">No recent activity.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<style>
  .dashboard-shell{max-width:1100px;margin:60px auto;padding:0 20px}
  .dashboard-card{background:#fff;padding:24px 24px 28px;border-radius:16px;box-shadow:0 18px 50px rgba(0,0,0,0.06)}
  .header-row{display:flex;justify-content:space-between;align-items:flex-start;gap:16px;margin-bottom:18px}
  .tables-grid{display:flex;flex-direction:column;gap:18px}
  .table-card table{width:100%;border-collapse:collapse;font-size:14px}
  .table-card th,.table-card td{padding:10px 6px;border-bottom:1px solid #eee;text-align:left;vertical-align:top}
  .table-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .pill{background:#f3e8ff;color:#4b0082;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600}
  .link-btn{color:var(--purple);text-decoration:none;font-weight:600;font-size:13px}
  .link-btn:hover{text-decoration:underline}
  .btn-tertiary{background:#f4f4f4;color:#333;padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:600}
  .btn-tertiary:hover{background:#e7e7e7}
  .empty-cell{text-align:center;color:var(--muted);font-style:italic}
  .muted{color:var(--muted);font-size:12px}
  .text-right{text-align:right}
  @media(max-width:800px){
    .header-row{flex-direction:column;align-items:flex-start}
  }
</style>
{% endblock %}

