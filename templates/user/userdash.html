{% extends "base.html" %}

{% block title %}Customer Dashboard ‚Äî SmartPrint Pro{% endblock %}

{% block extra_css %}
<style>
  * { box-sizing: border-box; }
  
  .dashboard-container {
    max-width: 1400px;
    margin: 40px auto;
    padding: 0 20px;
  }

  .dashboard-header {
    background: linear-gradient(135deg, var(--purple) 0%, #571590 100%);
    color: white;
    padding: 32px;
    border-radius: 16px;
    margin-bottom: 32px;
    box-shadow: 0 10px 40px rgba(107,33,168,0.3);
  }

  .dashboard-header h1 {
    margin: 0 0 8px;
    font-size: 32px;
    font-weight: 800;
  }

  .dashboard-header p {
    margin: 0;
    opacity: 0.95;
    font-size: 16px;
  }

  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    border-left: 4px solid var(--purple);
  }

  .stat-card h3 {
    margin: 0 0 8px;
    font-size: 14px;
    text-transform: uppercase;
    color: var(--muted);
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .stat-value {
    font-size: 36px;
    font-weight: 800;
    color: var(--purple);
    margin: 0;
  }

  .main-content {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 24px;
    margin-bottom: 32px;
  }

  @media(max-width: 1200px) {
    .main-content {
      grid-template-columns: 1fr;
    }
  }

  .card {
    background: white;
    padding: 28px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .card h2 {
    margin: 0 0 20px;
    font-size: 20px;
    font-weight: 700;
    color: var(--purple);
  }

  /* Upload Section */
  .upload-zone {
    border: 3px dashed #e8e6f2;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    background: #faf9fc;
    transition: all 0.3s;
    cursor: pointer;
  }

  .upload-zone:hover {
    border-color: var(--purple);
    background: #f5f3f8;
  }

  .upload-zone.dragover {
    border-color: var(--purple);
    background: #ede8f5;
    transform: scale(1.02);
  }

  .upload-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }

  .upload-zone h3 {
    margin: 0 0 8px;
    color: var(--purple);
    font-size: 18px;
  }

  .upload-zone p {
    margin: 0 0 16px;
    color: var(--muted);
    font-size: 14px;
  }

  .file-input {
    display: none;
  }

  .btn-upload {
    background: var(--purple);
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 15px;
    transition: background 0.2s;
  }

  .btn-upload:hover {
    background: #571590;
  }

  .btn-secondary {
    background: #e8e6f2;
    color: var(--purple);
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-size: 15px;
    margin-left: 8px;
    transition: background 0.2s;
  }

  .btn-secondary:hover {
    background: #d4d0e2;
  }

  /* Progress Bar */
  .progress-container {
    display: none;
    margin-top: 20px;
  }

  .progress-container.active {
    display: block;
  }

  .progress-bar {
    width: 100%;
    height: 8px;
    background: #e8e6f2;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 8px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--purple), #571590);
    border-radius: 4px;
    transition: width 0.3s;
    width: 0%;
  }

  .progress-text {
    font-size: 13px;
    color: var(--muted);
    text-align: center;
  }

  /* Jobs Table */
  .jobs-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
  }

  .jobs-table th {
    text-align: left;
    padding: 12px;
    background: #faf9fc;
    font-weight: 600;
    font-size: 13px;
    text-transform: uppercase;
    color: var(--muted);
    border-bottom: 2px solid #e8e6f2;
  }

  .jobs-table td {
    padding: 16px 12px;
    border-bottom: 1px solid #e8e6f2;
    font-size: 14px;
  }

  .jobs-table tr:hover {
    background: #faf9fc;
  }

  .status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
  }

  .status-pending {
    background: #fff3cd;
    color: #856404;
  }

  .status-awaiting_vendor {
    background: #cfe2ff;
    color: #084298;
  }

  .status-quoted {
    background: #e7d1f9;
    color: #5a1a8f;
  }

  .status-quote_revised {
    background: #f8e8ff;
    color: #6b21a8;
  }

  .status-approved {
    background: #d1e7dd;
    color: #0f5132;
  }

  .status-accepted {
    background: #d1e7dd;
    color: #0f5132;
  }

  .status-printing {
    background: #e7d1f9;
    color: #5a1a8f;
  }

  .status-in_progress {
    background: #e7d1f9;
    color: #5a1a8f;
  }

  .status-ready {
    background: #b8e0d2;
    color: #0a5c42;
  }

  .status-dispatched {
    background: #cfe2ff;
    color: #084298;
  }

  .status-completed {
    background: #d1e7dd;
    color: #0a3622;
  }

  .status-cancelled {
    background: #f8d7da;
    color: #842029;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }

  .empty-state-icon {
    font-size: 64px;
    margin-bottom: 16px;
    opacity: 0.5;
  }

  /* Quick Actions */
  .quick-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .action-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: white;
    border: 2px solid #e8e6f2;
    border-radius: 10px;
    text-decoration: none;
    color: inherit;
    transition: all 0.2s;
    font-weight: 600;
  }

  .action-btn:hover {
    border-color: var(--purple);
    background: #faf9fc;
    transform: translateX(4px);
  }

  .action-icon {
    font-size: 24px;
  }

  .alert {
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 14px;
  }

  .alert-success {
    background: #d1e7dd;
    color: #0f5132;
    border-left: 4px solid #0a3622;
  }

  .alert-error {
    background: #f8d7da;
    color: #842029;
    border-left: 4px solid #a02834;
  }

  .alert-info {
    background: #cfe2ff;
    color: #084298;
    border-left: 4px solid #052c65;
  }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Welcome back, {{ user.full_name.split()[0] }}! üëã</h1>
    <p>Manage your print jobs, upload new documents, and track your orders all in one place.</p>
  </div>

  <!-- Stats Grid -->
  <div class="dashboard-grid">
    <div class="stat-card">
      <h3>Total Orders</h3>
      <p class="stat-value">{{ orders|length }}</p>
    </div>
    <div class="stat-card">
      <h3>Quotes to Review</h3>
      <p class="stat-value">{{ orders|selectattr('status', 'in', ['quoted', 'quote_revised'])|list|length }}</p>
    </div>
    <div class="stat-card">
      <h3>In Progress</h3>
      <p class="stat-value">{{ orders|selectattr('status', 'in', ['accepted', 'in_progress', 'ready', 'dispatched'])|list|length }}</p>
    </div>
    <div class="stat-card">
      <h3>Completed</h3>
      <p class="stat-value">{{ orders|selectattr('status', 'equalto', 'completed')|list|length }}</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Left Column: Create Order & Orders -->
    <div>
      <!-- Create Order Card -->
      <div class="card">
        <h2>üìã Create New Order</h2>
        <p style="color: var(--muted); margin-bottom: 20px;">Start a new print order with up to 5 different items. Each item can have unique specifications.</p>
        
        <a href="{{ url_for('create_order') }}" class="btn-upload" style="display: inline-block; text-decoration: none; text-align: center;">
          + Create New Order
        </a>
      </div>

      <!-- Orders Table -->
      <div class="card" style="margin-top: 24px;">
        <h2>üì¶ Your Orders</h2>
        
        {% if orders %}
        <table class="jobs-table">
          <thead>
            <tr>
              <th>Order #</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
            <tr>
              <td><strong>{{ order.order_number }}</strong></td>
              <td>{{ order.order_items|length }} item(s)</td>
              <td><strong>KSh {{ "%.2f"|format(order.total_amount) }}</strong></td>
              <td>
                <span class="status-badge status-{{ order.status }}">
                  {{ order.status.replace('_', ' ') }}
                </span>
              </td>
              <td>{{ order.created_at.strftime('%b %d, %Y') }}</td>
              <td>
                <a href="{{ url_for('customer_view_order', order_id=order.id) }}" style="color:var(--purple);text-decoration:none;font-weight:600;">View</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="empty-state">
          <div class="empty-state-icon">üì≠</div>
          <h3>No orders yet</h3>
          <p>Create your first order to get started!</p>
          <a href="{{ url_for('create_order') }}" class="btn-upload" style="display: inline-block; margin-top: 16px; text-decoration: none;">
            + Create New Order
          </a>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Right Column: Quick Actions -->
    <div>
      <div class="card">
        <h2>‚ö° Quick Actions</h2>
        <div class="quick-actions">
          <a href="{{ url_for('create_order') }}" class="action-btn">
            <span class="action-icon">üìã</span>
            <div>
              <div>Create New Order</div>
              <small style="color:var(--muted);font-weight:400;">Start a new print order</small>
            </div>
          </a>
          
          <a href="{{ url_for('vendors') }}" class="action-btn">
            <span class="action-icon">üè™</span>
            <div>
              <div>Browse Vendors</div>
              <small style="color:var(--muted);font-weight:400;">Find print shops near you</small>
            </div>
          </a>
          
          <a href="{{ url_for('edit_account') }}" class="action-btn">
            <span class="action-icon">‚öôÔ∏è</span>
            <div>
              <div>Account Settings</div>
              <small style="color:var(--muted);font-weight:400;">Update your profile</small>
            </div>
          </a>
          
          <a href="#" class="action-btn">
            <span class="action-icon">üí¨</span>
            <div>
              <div>Contact Support</div>
              <small style="color:var(--muted);font-weight:400;">Get help with your orders</small>
            </div>
          </a>
        </div>
      </div>

      <!-- Tips Card -->
      <div class="card" style="margin-top: 24px; background: linear-gradient(135deg, #f5f3f8 0%, #faf9fc 100%);">
        <h2>üí° Tips</h2>
        <ul style="margin: 0; padding-left: 20px; color: var(--muted);">
          <li style="margin-bottom: 12px;">Create orders with multiple items for bulk discounts</li>
          <li style="margin-bottom: 12px;">Upload high-resolution files for best print quality</li>
          <li style="margin-bottom: 12px;">PDF format is recommended for documents</li>
          <li>Check vendor reviews before placing orders</li>
        </ul>
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
{% endblock %}
{% endblock %}

